trigger: none

pr: none

variables:
- template: variables/pipeline-vars-common.yml

stages:
- stage: Build
  displayName: 'Publish IaC Artifacts'
  jobs:
  - job: Build
    pool:
      vmImage: ubuntu-latest
    steps:
    - task: CopyFiles@2
      displayName: 'Copy ARM templates'
      inputs:
        sourceFolder: 'azure-pipelines/templates'
        targetFolder: '$(Build.ArtifactStagingDirectory)'
    - publish: '$(Build.ArtifactStagingDirectory)'
      artifact: $(artifactName)

- stage: DEV
  displayName: 'DEV Deployment'
  variables:
  - template: variables/pipeline-vars-dev.yml
  jobs:
  - template: templates/template-iac-logicapp.yml
    parameters:
      environment: 'dev'
      serviceConnection: 'AZD-EST-SND1'

#- stage: TEST
#  displayName: 'TEST Deployment'
#  variables:
#  - template: variables/pipeline-vars-test.yml
#  jobs:
#  - template: templates/template-iac-logicapp.yml
#    parameters:
#      environment: 'test'
#      serviceConnection: 'AZD-EST-SND1'
#      ${{ variables.serviceConnection }}
